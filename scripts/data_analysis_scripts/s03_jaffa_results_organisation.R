# Script Title: Filter HighConfidence Rows from JAFFA Results CSV Files
# Molly Romanis
# 08/08/24

# Description:
# This R script processes a collection of CSV files containing transcriptomic data
# generated by the JAFFA pipeline. The script filters out rows where the 'classification'
# column is not labeled as 'HighConfidence'. The filtered results are saved in a new
# folder, with filenames indicating that they contain only 'HighConfidence' results.

##### Load Necessary Libraries #####
library(dplyr)    # For data manipulation functions like filter()
library(stringr)  # For string manipulation functions like str_remove()
library(glue)     # For constructing strings with variable interpolation

##### Set Working Directory #####
setwd("~/masters/thesis_project/wf_trancriptomics_results/directRNA")

##### Define Input and Output Folders #####
input_folder <- "jaffa_results"          # Folder containing the original CSV files
output_folder <- "h_c_jaffa_results"     # Folder where filtered CSV files will be saved

##### Create Output Folder If It Doesn't Exist #####
if (!dir.exists(output_folder)) {
  dir.create(output_folder)
}

##### List All CSV Files in the Input Folder #####
file_list <- list.files(input_folder, pattern = "\\.csv$", full.names = TRUE)

##### Process Each File #####
for (file in file_list) {
  
  # Read the CSV file into a data frame
  data <- read.csv(file, stringsAsFactors = FALSE)
  
  # Filter the rows where the 'classification' column is 'HighConfidence'
  filtered_data <- data %>% filter(classification == "HighConfidence")
  
  # Extract the base name of the file without the '_jaffa_results.csv' suffix
  prefix <- str_remove(basename(file), "_jaffa_results\\.csv$")
  
  # Construct the output file path using the extracted prefix and new suffix
  output_file <- glue("{output_folder}/{prefix}_h_c_jaffa_results.csv")
  
  # Save the filtered data to the new CSV file
  write.csv(filtered_data, file = output_file, row.names = FALSE, quote = FALSE)
  
  # Print a message indicating that the file has been processed
  message("Processed: ", basename(file))
}

##### Print Completion Message #####
message("All files processed successfully!")

